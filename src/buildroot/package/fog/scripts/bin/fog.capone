#!/bin/sh
<<<<<<< HEAD
. /usr/share/fog/lib/funcs.sh
. /bin/fog.donate
=======
. /usr/share/fog/lib/funcs.sh;
. /bin/fog.donate;
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
for arg in `cat /proc/cmdline`; do
    case "$arg" in
	initsh)
	    ash -i
	    ;;
	*)
	    ;;
    esac
done
lookAtMe()
{
<<<<<<< HEAD
	while true
	do
=======
	while true; do
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
		clear;
		echo "";
		echo " #############################################################################";
		echo " #                                                                           #";	
		echo " #                     An error has been detected!                           #";
		echo " #                                                                           #";	
		echo " #############################################################################";
		echo -n -e "\007";
		echo -n -e "\007";
		echo -n -e "\007";
		echo "";
		echo "";
		echo -e " $1";
		echo "";
		echo "";
		echo " #############################################################################";
		echo " #                                                                           #";	
		echo " #                     An error has been detected!                           #";
		echo " #                                                                           #";	
		echo " #############################################################################";	
		echo "";
		sleep 5;
		strwhite="";
<<<<<<< HEAD
		for i in $(seq 0 99);
		do
			for z in $(seq 0 99);
			do
=======
		for i in $(seq 0 99); do
			for z in $(seq 0 99); do
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
				strwhite="${strwhite}#";
			done
		done
		echo $strwhite;
		sleep 1;
		strblack="";
<<<<<<< HEAD
		for i in $(seq 0 99);
		do
			for z in $(seq 0 99);
			do
=======
		for i in $(seq 0 99); do
			for z in $(seq 0 99); do
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
				strblack="${strblack} ";
			done
		done
		echo $strblack;
		sleep 1;
		echo $strwhite;
		sleep 1;
		echo $strblack;
		sleep 1;
	done
}
export capone="1";
clear;
displayBanner;
<<<<<<< HEAD
setupDNS ${dns}
echo " * Loading Capone...";	
echo
dots "Looking up DMI field";	
dmi="";
while [ "$dmi" = "" ]; do
	dmi=`wget -O - "http://${web}service/capone.php?action=dmi" 2>/dev/null`
	sleep 2;
done	
echo "Done";	
=======
setupDNS ${dns};
echo " * Loading Capone...";	
echo;
dots "Looking up DMI field";	
dmi="";
while [ "$dmi" = "" ]; do
	dmi=`wget -O - "http://${web}service/capone.php?action=dmi" 2>/dev/null`;
	sleep 2;
done	
echo "Done";
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
dmivalue=`dmidecode -s "${dmi}"`;
echo "";
echo " * Using Key Value: ${dmivalue}";
echo "";
sleep 1;
<<<<<<< HEAD
dmi64=`echo $dmivalue | base64`
dots "Looking for images";	
img="";
while [ "$img" = "" ]; do
	img=`wget -O - "http://${web}service/capone.php?action=imagelookup&key=${dmi64}" 2>/dev/null`
=======
dmi64=`echo $dmivalue | base64`;
dots "Looking for images";
img="";
while [ "$img" = "" ]; do
	img=`wget -O - "http://${web}service/capone.php?action=imagelookup&key=${dmi64}" 2>/dev/null`;
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
	sleep 2;
done	
echo "Done";
oIFS=$IFS;
IFS="
";
cnt=0;
linedecode="";
echo "";
<<<<<<< HEAD
for line in $img
do		
	linedecode=`echo "$line" | base64 -d `
	if [ "$linedecode" = "null" ]
	then
=======
for line in $img; do
	linedecode=`echo "$line" | base64 -d `;
	if [ "$linedecode" = "null" ]; then
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
		lookAtMe "No image definition was found for $dmivalue";
	fi
	cnt=`expr $cnt + 1`;
	determineOS `echo $linedecode | awk -F"|" '{ print $2 }'`;	
	echo -n " ID $cnt) ";
	echo -n " OS: $osname";
	echo -n " Image: ";
	echo `echo $linedecode | awk -F"|" '{ print $1 }'`;
	sleep 1;
done
echo "";
<<<<<<< HEAD
if [ "$cnt" = "1" ]
then
=======
if [ "$cnt" = "1" ]; then
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
	img=`echo $linedecode | awk -F"|" '{ print $1 }'`;
	osid=`echo $linedecode | awk -F"|" '{ print $2 }'`;
	imgType=`echo $linedecode | awk -F"|" '{ print $3 }'`;
	determineOS $osid;
<<<<<<< HEAD
elif [ "$cnt" = "0" ]
then
	lookAtMe "No image definition was found for $dmivalue";
else
	imgchoice="";
	while [ "$imgchoice" = "" ]
	do
=======
elif [ "$cnt" = "0" ]; then
	lookAtMe "No image definition was found for $dmivalue";
else
	imgchoice="";
	while [ "$imgchoice" = "" ]; do
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
		echo -n " Multiple images found, please select an image #: ";
		read imgchoice;
	done
	cnt=0;
<<<<<<< HEAD
	for line in $img
	do		
		linedecode=`echo "$line" | base64 -d`
		cnt=`expr $cnt + 1`;
		if [ "$cnt" = "$imgchoice" ]
		then
			img=`echo $linedecode | awk -F"|" '{ print $1 }'`;
			osid=`echo $linedecode | awk -F"|" '{ print $2 }'`;
			imgType=`echo $linedecode | awk -F"|" '{ print $3 }'`;
			determineOS $osid;				
=======
	for line in $img; do		
		linedecode=`echo "$line" | base64 -d`
		cnt=`expr $cnt + 1`;
		if [ "$cnt" = "$imgchoice" ]; then
			img=`echo $linedecode | awk -F"|" '{ print $1 }'`;
			osid=`echo $linedecode | awk -F"|" '{ print $2 }'`;
			imgType=`echo $linedecode | awk -F"|" '{ print $3 }'`;
			determineOS $osid;
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
			break;
		fi
	done
fi
IFS=$oIFS;
echo "";
dots "Setting up environment to deploy image";
<<<<<<< HEAD
export type=down 
=======
export type="down";
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
export mac="00:00:00:00:00:00";					# Not important for Capone
export img;
export osid;
export imgType;
sleep 2;
clear;
<<<<<<< HEAD
fog
=======
fog;
>>>>>>> 5e6f2ff5445db9f6ab2678bfad76acfcacc85157
